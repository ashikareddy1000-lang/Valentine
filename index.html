<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Piccolo, will you be mine forever? ğŸ’–</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root {
      --pink:#ff4d79; --rose:#ffe1ea; --text:#522836; --bg:#fff7fb;
      --box:#ffffff; --line:#ffd2df; --accent:#e23f6a;
    }
    html,body{margin:0;padding:0;background:var(--bg);font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;color:var(--text)}
    .wrap{min-height:100dvh;display:flex;align-items:center;justify-content:center;padding:18px;position:relative;overflow:hidden}
    .card{width:min(720px,92vw);background:var(--box);border-radius:16px;border:1px solid var(--line);box-shadow:0 8px 18px rgba(0,0,0,.06);padding:20px;position:relative;z-index:3}
    h1{margin:.25rem 0 .75rem;font-size:clamp(24px,4.8vw,36px);color:var(--accent);text-align:center}
    p.sub{text-align:center;opacity:.85;margin:.25rem 0 1rem}
    .center{display:flex;justify-content:center;gap:10px;margin-bottom:8px}
    .btn{border:none;border-radius:10px;padding:12px 18px;cursor:pointer;font-size:16px}
    .btn-yes{background:var(--pink);color:#fff}
    .btn-no{background:var(--rose);color:#a01e43}

    /* Multi-step form */
    form{display:none;margin-top:12px;border:1.5px solid var(--line);border-radius:14px;padding:14px;background:#fff}
    fieldset{border:none;margin:0;padding:0}
    .legend{font-weight:700;margin-bottom:8px;display:block}
    label.option{display:block;border:1px solid var(--line);border-radius:10px;padding:10px 12px;margin:8px 0;cursor:pointer;background:#fff}
    label.option:has(input:checked){outline:2px solid var(--pink); background:#fff9fb;}
    label.option input{margin-right:10px}
    .row{display:flex;gap:10px;align-items:center}
    .row small{opacity:.7}
    .actions{display:flex;gap:10px;justify-content:space-between;margin-top:14px}
    .secondary{background:#ffe1ea;color:#a01e43;border:none;border-radius:10px;padding:10px 14px;cursor:pointer}
    .primary{background:var(--pink);color:#fff;border:none;border-radius:10px;padding:10px 16px;cursor:pointer}

    /* Steps container */
    .step{display:none;animation:fade .25s ease}
    .step.active{display:block}
    @keyframes fade{from{opacity:0;transform:translateY(4px)}to{opacity:1;transform:none}}

    /* Progress */
    .progress-wrap{display:flex;align-items:center;gap:10px;margin:6px 0 12px}
    .progress{appearance:none;height:10px;width:100%;border-radius:999px;overflow:hidden;background:#ffe9f0;border:1px solid var(--line)}
    .progress::-webkit-progress-bar{background:#ffe9f0}
    .progress::-webkit-progress-value{background:var(--pink);border-radius:999px}
    .progress-value{font-size:12px;opacity:.75;min-width:48px;text-align:right}

    /* Floating layers (behind the card) */
    .bg-layer{position:fixed; inset:0; overflow:hidden; pointer-events:none;}
    .hearts-layer{z-index:1;}
    .dolls-layer{z-index:2;} /* dolls above hearts, below the card */

    /* Heart/Doll animation (shared) */
    .sprite{
      position:absolute; bottom:-60px; will-change: transform, opacity; filter: drop-shadow(0 2px 2px rgba(0,0,0,.06));
      animation: floatUp var(--dur) linear forwards, sway var(--sway-dur) ease-in-out infinite alternate;
    }
    .sprite.emoji{font-size: clamp(22px, 3.2vw, 34px)}
    .sprite.img{width: var(--size); height: var(--size)}
    .sprite img{width:100%; height:100%; object-fit:contain; display:block}

    @keyframes floatUp{
      from{transform:translateY(0) scale(var(--scale)); opacity:0}
      10%{opacity:0.95}
      to{transform:translateY(-120vh) scale(var(--scale)); opacity:0}
    }
    @keyframes sway{
      from{transform: translateX(-10px) translateY(0) scale(var(--scale))}
      to{transform: translateX(10px) translateY(0) scale(var(--scale))}
    }

    /* Toast for final summary */
    .toast {
      position: fixed; left: 50%; top: 18px; transform: translateX(-50%);
      background: #ffffff; border: 1px solid var(--line); border-radius: 12px;
      padding: 12px 14px; box-shadow: 0 8px 18px rgba(0,0,0,.08);
      z-index: 99; max-width: min(92vw, 680px);
    }
    .toast h3 { margin: 0 0 6px; color: var(--accent); font-size: 16px; }
    .toast pre { margin: 0; white-space: pre-wrap; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; font-size: 13px; }
    .toast .close { background: var(--rose); color: #a01e43; border: none; border-radius: 8px; padding: 6px 10px; cursor: pointer; margin-top: 8px; }

    /* Hero sticker (your illustration inside the card) */
    .hero-wrap{ display:flex; justify-content:center; margin:6px 0 4px; }
    .hero-sticker{
      width:min(220px, 36vw);
      user-select:none; pointer-events:none;
      filter: drop-shadow(0 6px 14px rgba(0,0,0,.09));
      animation: bob 4.8s ease-in-out infinite;
    }
    @keyframes bob{
      0%{ transform: translateY(0) }
      50%{ transform: translateY(-6px) }
      100%{ transform: translateY(0) }
    }

    /* Reduced motion respect */
    @media (prefers-reduced-motion: reduce){
      .sprite{animation:none}
      .hero-sticker{animation:none}
    }
  </style>
</head>
<body>
  <!-- Floating background layers -->
  <div class="bg-layer hearts-layer" aria-hidden="true"></div>
  <div class="bg-layer dolls-layer" aria-hidden="true"></div>

  <div class="wrap">
    <div class="card" role="dialog" aria-modal="true" aria-labelledby="title">
      <!-- Hero sticker added here -->
      <div class="hero-wrap" aria-hidden="true">
        <img src="./Animae.png" alt="Couple illustration" class="hero-sticker" width="220" height="220>ğŸ’˜</div>
      <h1 id="title">Piccolo, will you be mine forever?</h1>
      <p class="sub">I have a strong feeling youâ€™ll pick the right answer ğŸ˜‰</p>

      <div class="center" id="choiceRow">
        <button type="button" class="btn btn-yes" id="yesBtn" aria-describedby="startsQuiz">Yes ğŸ’–</button>
        <button type="button" class="btn btn-no"  id="noBtn">No ğŸ˜…</button>
      </div>
      <span id="startsQuiz" class="sr-only" style="position:absolute;left:-9999px">Starts a cute 5â€‘question miniâ€‘quiz</span>

      <!-- Multi-step fun quiz -->
      <form id="quizForm" aria-live="polite" aria-describedby="progressText">
        <div class="progress-wrap">
          <progress class="progress" id="progressBar" max="5" value="1"></progress>
          <div class="progress-value" id="progressText">1 / 5</div>
        </div>

        <!-- Step 1 -->
        <section class="step active" data-step="1">
          <fieldset>
            <span class="legend">1) Our first â€œforever dateâ€ should be:</span>
            <label class="option"><input type="radio" name="datePlan" value="Candlelight dinner with extra dessert ğŸ·ğŸ®"> Candlelight dinner with extra dessert ğŸ·ğŸ®</label>
            <label class="option"><input type="radio" name="datePlan" value="Street food crawl (chaat war) ğŸŒ®ğŸ”¥"> Street food crawl (chaat war) ğŸŒ®ğŸ”¥</label>
            <label class="option"><input type="radio" name="datePlan" value="Long drive while we sing offâ€‘key ğŸš—ğŸ¶"> Long drive while we sing offâ€‘key ğŸš—ğŸ¶</label>
            <label class="option"><input type="radio" name="datePlan" value="Secret surprise planned by me ğŸ"> Secret surprise planned by me ğŸ</label>
          </fieldset>
        </section>

        <!-- Step 2 -->
        <section class="step" data-step="2">
          <fieldset>
            <span class="legend">2) Your official title in my life?</span>
            <label class="option"><input type="radio" name="title" value="CEO of My Heart ğŸ’¼â¤ï¸"> CEO of My Heart ğŸ’¼â¤ï¸</label>
            <label class="option"><input type="radio" name="title" value="Chief Cuddle Officer ğŸ§¸"> Chief Cuddle Officer ğŸ§¸</label>
            <label class="option"><input type="radio" name="title" value="Director of Surprises ğŸ"> Director of Surprises ğŸ</label>
            <label class="option"><input type="radio" name="title" value="Minister of Memes ğŸ˜‚"> Minister of Memes ğŸ˜‚</label>
          </fieldset>
        </section>

        <!-- Step 3 -->
        <section class="step" data-step="3">
          <fieldset>
            <span class="legend">3) Emergency â€œkeep Ashika happyâ€ kit includes:</span>
            <label class="option"><input type="radio" name="kit" value="Chocolate therapy + hugs ğŸ«ğŸ¤—"> Chocolate therapy + hugs ğŸ«ğŸ¤—</label>
            <label class="option"><input type="radio" name="kit" value="Iceâ€‘cream + bad jokes ğŸ¦ğŸ˜…"> Iceâ€‘cream + bad jokes ğŸ¦ğŸ˜…</label>
            <label class="option"><input type="radio" name="kit" value="Gulab jamun + cozy movie ğŸ¯ğŸ¬"> Gulab jamun + cozy movie ğŸ¯ğŸ¬</label>
            <label class="option"><input type="radio" name="kit" value="Cute selfie + forehead kiss ğŸ“¸ğŸ’‹"> Cute selfie + forehead kiss ğŸ“¸ğŸ’‹</label>
          </fieldset>
        </section>

        <!-- Step 4 -->
        <section class="step" data-step="4">
          <fieldset>
            <span class="legend">4) Who wins the bill battle?</span>
            <label class="option"><input type="radio" name="bill" value="We split like champs âš–ï¸"> We split like champs âš–ï¸</label>
            <label class="option"><input type="radio" name="bill" value="You pay (because youâ€™re fancy) âœ¨"> You pay (because youâ€™re fancy) âœ¨</label>
            <label class="option"><input type="radio" name="bill" value="I pay (Iâ€™m luckier) ğŸ€"> I pay (Iâ€™m luckier) ğŸ€</label>
            <label class="option"><input type="radio" name="bill" value="Rockâ€“Paperâ€“Scissors decides âœŠâœ‹âœŒï¸"> Rockâ€“Paperâ€“Scissors decides âœŠâœ‹âœŒï¸</label>
          </fieldset>
        </section>

        <!-- Step 5 -->
        <section class="step" data-step="5">
          <fieldset>
            <span class="legend">5) Rate your â€œforever with meâ€ excitement:</span>
            <div class="row">
              <small>Lowâ€‘key ğŸ˜Š</small>
              <input type="range" name="excitement" id="exSlider" min="1" max="10" value="9" style="flex:1" aria-label="Excitement out of 10">
              <small>Over the moon ğŸ¤©</small>
            </div>
            <div id="exLabel" style="font-size:12px;opacity:.8;margin-top:4px;">9/10 ğŸ˜</div>
          </fieldset>
        </section>

        <div class="actions">
          <div>
            <button type="button" class="secondary" id="backBtn" disabled>Back</button>
          </div>
          <div>
            <button type="button" class="secondary" id="cancelBtn">Cancel</button>
            <button type="button" class="primary" id="nextBtn">Next âœ</button>
            <button type="submit" class="primary" id="finishBtn" style="display:none">Finish ğŸ‰</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <script>
    // ======= Elements =======
    const yesBtn = document.getElementById('yesBtn');
    const noBtn = document.getElementById('noBtn');
    const form = document.getElementById('quizForm');
    const exSlider = document.getElementById('exSlider');
    const exLabel  = document.getElementById('exLabel');
    const cancelBtn = document.getElementById('cancelBtn');
    const backBtn = document.getElementById('backBtn');
    const nextBtn = document.getElementById('nextBtn');
    const finishBtn = document.getElementById('finishBtn');
    const steps = Array.from(document.querySelectorAll('.step'));
    const progressBar = document.getElementById('progressBar');
    const progressText = document.getElementById('progressText');
    const heartsLayer = document.querySelector('.hearts-layer');
    const dollsLayer = document.querySelector('.dolls-layer');

    // ======= Quiz flow =======
    let currentStep = 1;
    const totalSteps = steps.length;

    function showForm() {
      form.style.display = 'block';
      form.scrollIntoView({ behavior: 'smooth', block: 'start' });
      currentStep = 1;
      updateUI();
      const firstInput = steps[0].querySelector('input');
      if (firstInput) firstInput.focus({ preventScroll: true });
    }

    function hideForm() {
      form.style.display = 'none';
    }

    function go(stepDelta) {
      // Validate required choice for steps 1..4 (radio selection)
      if (stepDelta > 0 && currentStep >= 1 && currentStep <= 4) {
        const radios = steps[currentStep-1].querySelectorAll('input[type="radio"]');
        const oneChecked = Array.from(radios).some(r => r.checked);
        if (radios.length && !oneChecked) {
          alert('Pick one option before moving ahead ğŸ’•');
          return;
        }
      }
      currentStep = Math.min(Math.max(1, currentStep + stepDelta), totalSteps);
      updateUI();
      const firstInput = steps[currentStep-1].querySelector('input');
      if (firstInput) firstInput.focus({ preventScroll: true });
    }

    function updateUI() {
      steps.forEach((s, idx) => s.classList.toggle('active', idx === currentStep - 1));
      progressBar.value = currentStep;
      progressText.textContent = `${currentStep} / ${totalSteps}`;
      backBtn.disabled = currentStep === 1;
      nextBtn.style.display = currentStep === totalSteps ? 'none' : '';
      finishBtn.style.display = currentStep === totalSteps ? '' : 'none';
    }

    function resetForm() {
      form.reset();
      if (exLabel && exSlider) exLabel.textContent = `${exSlider.value}/${exSlider.max} ğŸ˜`;
      currentStep = 1;
      updateUI();
    }

    // ======= Floating Hearts (start on load) =======
    let heartsTimer = null;
    const heartChars = ['ğŸ’–','ğŸ’˜','ğŸ’','ğŸ’—','ğŸ’“','ğŸ’'];
    function spawnHeart() {
      const el = document.createElement('div');
      el.className = 'sprite emoji';
      el.textContent = heartChars[(Math.random()*heartChars.length)|0];

      const vw = Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0);
      const left = Math.random() * vw;
      const scale = (Math.random() * 0.6 + 0.7).toFixed(2); // 0.7 - 1.3
      const dur = (Math.random() * 3 + 5).toFixed(2) + 's'; // 5s - 8s
      const swayDur = (Math.random() * 2 + 2).toFixed(2) + 's'; // 2s - 4s

      el.style.left = `${left}px`;
      el.style.setProperty('--scale', scale);
      el.style.setProperty('--dur', dur);
      el.style.setProperty('--sway-dur', swayDur);
      heartsLayer.appendChild(el);
      el.addEventListener('animationend', () => el.remove());
    }
    function startHearts() {
      if (window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;
      if (heartsTimer) return;
      heartsTimer = setInterval(() => {
        const count = Math.random() < 0.35 ? 2 : 1;
        for (let i=0;i<count;i++) spawnHeart();
        const maxHearts = 42;
        while (heartsLayer.children.length > maxHearts) heartsLayer.removeChild(heartsLayer.firstChild);
      }, 520);
    }
    function stopHearts() {
      if (!heartsTimer) return;
      clearInterval(heartsTimer);
      heartsTimer = null;
    }

    // ======= Floating Dolls (use your illustration; start on load) =======
    let dollsTimer = null;

    // Preload your image to avoid first-frame flicker
    ['.//Animae.png','./Animae.png'].forEach(src => { const im = new Image(); im.src = src; });

    // Use the illustration in different sizes for depth
    const dollSet = [
      { type:'img', src:'./Animae.png', size:'56px' },
      { type:'img', src:'./Animae.png', size:'68px' },
      { type:'img', src:'./Animae.png', size:'80px' }
      // You can add more or mix with emoji if you like
      // { type:'emoji', content:'ğŸ§¸' }
    ];

    function spawnDoll() {
      const vw = Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0);
      const left = Math.random() * vw;

      const scale = (Math.random() * 0.4 + 0.9).toFixed(2); // 0.9 - 1.3
      const dur = (Math.random() * 5 + 9).toFixed(2) + 's'; // slower: 9s - 14s
      const swayDur = (Math.random() * 2.5 + 2.5).toFixed(2) + 's'; // 2.5s - 5s

      const choice = dollSet[(Math.random()*dollSet.length)|0];

      let el;
      if (choice.type === 'img') {
        el = document.createElement('div');
        el.className = 'sprite img';
        el.style.setProperty('--size', choice.size || '52px');
        const img = document.createElement('img');
        img.alt = '';
        img.src = choice.src;
        el.appendChild(img);
      } else {
        el = document.createElement('div');
        el.className = 'sprite emoji';
        el.textContent = choice.content;
      }

      el.style.left = `${left}px`;
      el.style.setProperty('--scale', scale);
      el.style.setProperty('--dur', dur);
      el.style.setProperty('--sway-dur', swayDur);
      dollsLayer.appendChild(el);
      el.addEventListener('animationend', () => el.remove());
    }

    function startDolls() {
      if (window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;
      if (dollsTimer) return;
      // Spawn a "few" dolls: gentle density
      dollsTimer = setInterval(() => {
        const r = Math.random();
        const count = r < 0.15 ? 2 : (r < 0.6 ? 1 : 0);
        for (let i=0;i<count;i++) spawnDoll();
        const maxDolls = 16;
        while (dollsLayer.children.length > maxDolls) dollsLayer.removeChild(dollsLayer.firstChild);
      }, 900);
    }
    function stopDolls() {
      if (!dollsTimer) return;
      clearInterval(dollsTimer);
      dollsTimer = null;
    }

    // Pause animations when tab hidden (battery friendly)
    document.addEventListener('visibilitychange', () => {
      if (document.hidden) { stopHearts(); stopDolls(); }
      else { startHearts(); startDolls(); }
    });

    // ======= Event bindings =======
    yesBtn.addEventListener('click', function () {
      showForm();
      // keep animations running (they already start on load)
    });

    noBtn.addEventListener('click', function () {
      alert('Ahem... â€œNoâ€ is temporarily out of service ğŸ˜Œ Try â€œYesâ€?');
    });

    exSlider?.addEventListener('input', function () {
      const v = +exSlider.value, max = +exSlider.max, r = v/max;
      const mood = r >= .9 ? 'ğŸ¤¯ğŸ’–' : r >= .7 ? 'ğŸ˜' : r >= .5 ? 'ğŸ˜Š' : r >= .3 ? 'ğŸ™‚' : 'ğŸ™ˆ';
      exLabel.textContent = `${v}/${max} ${mood}`;
    });

    cancelBtn.addEventListener('click', function () {
      hideForm();
      resetForm();
      // keep the ambient hearts & dolls running for vibe âœ¨
    });

    backBtn.addEventListener('click', () => go(-1));
    nextBtn.addEventListener('click', () => go(1));

    form.addEventListener('submit', function (e) {
      e.preventDefault();
      const pick = (name) => {
        const sel = form.querySelector(`input[name="${name}"]:checked`);
        return sel ? sel.value : 'â€”';
      };
      const summary =
        `Date plan: ${pick('datePlan')}\n` +
        `Title: ${pick('title')}\n` +
        `Happiness kit: ${pick('kit')}\n` +
        `Bill battle: ${pick('bill')}\n` +
        `Excitement: ${form.excitement.value}/10\n\n` +
        `Itâ€™s a forever-date! ğŸ’–`;

      showToast('Yay! You said YES ğŸ’', summary);
      hideForm();
      resetForm();
      // leave the floating vibe on âœ¨
    });

    function showToast(title, text){
      const t = document.createElement('div');
      t.className = 'toast';
      t.innerHTML = `<h3>${title}</h3><pre>${text}</pre>`;
      const close = document.createElement('button');
      close.className = 'close';
      close.textContent = 'Close';
      close.addEventListener('click', ()=> t.remove());
      t.appendChild(close);
      document.body.appendChild(t);
      setTimeout(()=> t.remove(), 10000);
    }

    // Accessibility: allow Enter to advance if a radio was just selected
    form.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        const activeRadios = steps[currentStep-1].querySelectorAll('input[type="radio"]');
        if (activeRadios.length) {
          e.preventDefault();
          nextBtn.click();
        }
      }
    });

    // ======= Start hearts & dolls as soon as the page opens =======
    window.addEventListener('DOMContentLoaded', () => {
      startHearts();
      startDolls();
      // Small initial burst so you see them instantly
      for (let i=0;i<8;i++) spawnHeart();
      for (let i=0;i<3;i++) spawnDoll();
    });
  </script>
</body>
</html>
